다국어 적용 지침:
- 본 문서는 영어, 한국어, 일본어, 중국어 등의 다국어를 지원하기 위한 지침을 제공합니다.
- 다국어 적용을 할 때에는 반드시 본 지침을 준수해야 합니다.

# 다국어 적용 개요

1. 다국어 지원을 위해 Next-Intl 4.0 라이브러리를 사용합니다.
2. 지원 언어: 영어(en), 한국어(ko), 일본어(ja), 중국어(zh)
3. 공식 문서 참고:
   - https://next-intl.dev/docs/getting-started/app-router
   - https://next-intl.dev/docs/usage/translations
   - https://next-intl.dev/docs/usage/numbers
   - https://next-intl.dev/docs/usage/dates-times
   - https://next-intl.dev/docs/usage/lists
   - https://next-intl.dev/docs/usage/configuration
   - https://next-intl.dev/docs/routing/setup
   - https://next-intl.dev/docs/routing/configuration
   - https://github.com/amannn/next-intl

---

## 목차
- [공식 문서 요약](#공식-문서-요약)
- [1. 설치 및 초기 설정](#1-설치-및-초기-설정)
- [2. 디렉토리 구조](#2-디렉토리-구조)
- [3. 번역 사용법](#3-번역-사용법)
- [4. 숫자 포맷팅](#4-숫자-포맷팅)
- [5. 날짜/시간 포맷팅](#5-날짜시간-포맷팅)
- [6. 리스트 포맷팅](#6-리스트-포맷팅)
- [7. 라우팅 설정](#7-라우팅-설정)
- [8. 본 프로젝트 적용 가이드](#8-본-프로젝트-적용-가이드)
- [참고 자료](#참고-자료)

---

## 공식 문서 요약

| 문서 | 핵심 요약 | 프로젝트 적용 메모 |
| --- | --- | --- |
| [Getting Started · App Router](https://next-intl.dev/docs/getting-started/app-router) | `createNextIntlPlugin`으로 Next.js 설정을 확장하고, `getRequestConfig`로 요청 단위 메시지/포맷을 로딩합니다. `NextIntlClientProvider`를 루트 레이아웃에서 감싸 클라이언트 훅이 동작하도록 합니다. | `next.config.ts`에 플러그인을 적용하고 `app/[locale]/layout.tsx`에서 `NextIntlClientProvider`를 사용해 공통 메시지를 전달합니다. |
| [Usage · Translations](https://next-intl.dev/docs/usage/translations) | `useTranslations`, `getTranslations`, `createTranslator`, `useMessages` 등 번역 API를 제공하며, 중첩 키, 변수 삽입, 복수형, 리치 텍스트 처리 방식을 설명합니다. | 서버 컴포넌트에서는 `getTranslations`, 클라이언트에서는 `useTranslations`를 사용하고, 리치 텍스트는 `t.rich`로 처리합니다. 네임스페이스를 분리해 메시지 크기를 최소화합니다. |
| [Usage · Numbers](https://next-intl.dev/docs/usage/numbers) | `useFormatter().number`와 글로벌 `formats` 설정을 통해 통화, 백분율, 분수 자릿수 등을 다국어에 맞게 일관되게 포맷합니다. | `app.config.ts` 등에서 사용하는 가격, 카운트 값에 `format.number`를 적용하고, `price`, `compact` 같은 사전 정의 포맷을 프로젝트 전역에서 재사용합니다. |
| [Usage · Dates & Times](https://next-intl.dev/docs/usage/dates-times) | `useFormatter().dateTime`, `relativeTime`, `time`, `useNow` 훅을 제공하여 시간대 및 상대 시각을 처리하고 자동 업데이트를 지원합니다. | 게시글/채팅 타임스탬프는 `format.relativeTime`과 `useNow`를 활용하고, 고정 포맷은 `formats.dateTime`에 등록해 재사용합니다. |
| [Usage · Lists](https://next-intl.dev/docs/usage/lists) | `format.list`로 and/or 조합, 단순 나열 등 언어별 문법을 적용할 수 있습니다. React 요소를 그대로 전달해도 올바르게 렌더링됩니다. | 포럼 카테고리, 사용자 태그, 관심사 등을 나열할 때 `format.list`를 사용하면 하드코딩된 구두점을 제거할 수 있습니다. |
| [Usage · Configuration](https://next-intl.dev/docs/usage/configuration) | `NextIntlClientProvider` 옵션, `formats`, `defaultTranslationValues`, `timeZone` 등을 조정하는 방법을 제공합니다. | 기본 locale은 `ko`, 시간대는 `Asia/Seoul`을 기본값으로 설정하고, 공통 포맷을 `app/i18n/config.ts` 같은 중앙 파일로 관리합니다. |
| [Routing · Setup](https://next-intl.dev/docs/routing/setup) | `defineRouting`, `createNavigation`, `createMiddleware`를 정의해 로케일 기반 라우팅과 내비게이션 헬퍼를 구성합니다. | `src/i18n/routing.ts`와 `app/navigation.ts`를 생성해 `Link`, `useRouter` 등 내비게이션 유틸을 locale 인지 버전으로 교체하고, 미들웨어를 통해 locale 감지를 활성화합니다. |
| [Routing · Configuration](https://next-intl.dev/docs/routing/configuration) | `localePrefix`, `pathnames`, `localeDetection`, `domains` 등 라우팅 동작을 세밀하게 조정하는 방법을 다룹니다. | 기본 locale는 접두사를 생략(`as-needed`), `/forum/list` 같은 경로는 `pathnames`로 선언하여 정적인 URL 매핑을 유지하고, 서버 사이드에서 필요하면 `localeDetection: false`로 고정합니다. |

---

## 1. 설치 및 초기 설정

### 패키지 설치
```bash
npm install next-intl
```

⚠️ **참고**: 본 프로젝트에는 Next-Intl 4.0이 이미 설치되어 있습니다.

### next.config.ts 설정
```typescript
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin();

export default withNextIntl({
  // 기존 Next.js 설정
});
```

### 루트 레이아웃 구성

`NextIntlClientProvider`는 클라이언트 훅(`useTranslations`, `useFormatter` 등)이 동작할 수 있도록 메시지, locale, 옵션을 전달합니다.

```tsx
// app/[locale]/layout.tsx
import {NextIntlClientProvider} from 'next-intl';
import {notFound} from 'next/navigation';
import {getMessages} from 'next-intl/server';
import {routing} from '@/i18n/routing';

export default async function LocaleLayout({
  children,
  params: {locale},
}: {
  children: React.ReactNode;
  params: {locale: string};
}) {
  if (!routing.locales.includes(locale)) {
    notFound();
  }

  const messages = await getMessages();

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider
          messages={messages}
          locale={locale}
          timeZone="Asia/Seoul"
        >
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
```

> `timeZone`는 [configuration 문서](https://next-intl.dev/docs/usage/configuration)의 권장값을 따라 `Asia/Seoul`을 기본으로 설정하되, 사용자 설정이 있다면 `request.ts`에서 동적으로 주입합니다.

---

## 2. 디렉토리 구조

```
├── messages/               # 번역 파일 디렉토리
│   ├── en.json            # 영어 번역
│   ├── ko.json            # 한국어 번역
│   ├── ja.json            # 일본어 번역
│   └── zh.json            # 중국어 번역
├── src/
│   ├── i18n/
│   │   ├── request.ts     # 요청별 설정 객체 생성
│   │   └── routing.ts     # 라우팅 설정 (지원 언어, 기본 locale)
│   ├── middleware.ts       # locale 감지 및 라우팅
│   └── app/
│       ├── [locale]/      # locale 동적 세그먼트
│       │   ├── layout.tsx # 루트 레이아웃
│       │   └── page.tsx   # 페이지
│       └── navigation.ts  # 라우팅 유틸리티
└── next.config.ts
```

### i18n/request.ts
요청별 설정 객체를 생성하여 locale과 메시지를 제공합니다.

```typescript
import {getRequestConfig} from 'next-intl/server';

export default getRequestConfig(async ({locale}) => {
  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default
  };
});
```

### messages/ko.json 예시
```json
{
  "common": {
    "submit": "전송",
    "cancel": "취소",
    "save": "저장",
    "delete": "삭제"
  },
  "auth": {
    "login": "로그인",
    "signup": "회원가입",
    "logout": "로그아웃"
  },
  "forum": {
    "title": "포럼",
    "createPost": "글쓰기",
    "noPost": "게시글이 없습니다"
  }
}
```

---

## 3. 번역 사용법

### useTranslations Hook

**기본 사용법:**
```typescript
import {useTranslations} from 'next-intl';

export default function Component() {
  const t = useTranslations('common');

  return (
    <button>{t('submit')}</button>
  );
}
```

### 중첩된 메시지 구조

**JSON 파일:**
```json
{
  "auth": {
    "SignUp": {
      "form": {
        "placeholder": "이메일을 입력하세요"
      }
    }
  }
}
```

**컴포넌트:**
```typescript
const t = useTranslations('auth.SignUp');
return <input placeholder={t('form.placeholder')} />;
```

### 변수 삽입 (Interpolation)

**JSON 파일:**
```json
{
  "welcome": "안녕하세요, {name}님!",
  "itemCount": "{count}개의 항목"
}
```

**컴포넌트:**
```typescript
const t = useTranslations('common');

t('welcome', {name: '홍길동'});  // "안녕하세요, 홍길동님!"
t('itemCount', {count: 5});       // "5개의 항목"
```

### 복수형 처리

**기수 복수형 (plural):**
```json
{
  "followers": "팔로워 {count, plural, =0 {없음} =1 {# 명} other {# 명}}"
}
```

```typescript
t('followers', {count: 0});  // "팔로워 없음"
t('followers', {count: 1});  // "팔로워 1 명"
t('followers', {count: 5});  // "팔로워 5 명"
```

**서수 복수형 (selectordinal):**
```json
{
  "birthday": "{year, selectordinal, one {#번째} other {#번째}} 생일"
}
```

### 서버 컴포넌트 번역

App Router에서는 서버 컴포넌트에서 `getTranslations` 또는 `createTranslator`를 사용해 빌드 타임 혹은 요청 시점에 번역 문자열을 생성합니다.

```tsx
// app/[locale]/forum/list/page.tsx (Server Component)
import {getTranslations} from 'next-intl/server';

export default async function ForumListPage() {
  const t = await getTranslations('forum');

  return (
    <section>
      <h1 className="text-3xl font-bold">{t('title')}</h1>
    </section>
  );
}
```

```ts
// lib/forum-metadata.ts
import {createTranslator} from 'next-intl';

export async function createForumSeo(locale: string) {
  const translator = await createTranslator({locale, namespace: 'forum'});
  return {
    title: translator('seo.title'),
    description: translator('seo.description'),
  };
}
```

> `createTranslator`는 `generateMetadata`, `generateStaticParams`, API Route 등 React 외부 컨텍스트에서 번역이 필요할 때 유용합니다.

### Rich 텍스트 & React 요소 번역

```json
// messages/ko.json
{
  "auth": {
    "terms": "약관에 <strong>동의</strong>했습니다."
  }
}
```

```tsx
const t = useTranslations('auth');

return t.rich('terms', {
  strong: (chunk) => <strong className="text-primary">{chunk}</strong>,
});
```

리치 텍스트 번역 시 문자열 일부분을 React 요소로 치환할 수 있으며, 공식 문서에서는 `t.rich`를 사용해 XSS 위험 없이 안전하게 처리할 것을 권장합니다.

### Provider 메시지 직접 접근

```tsx
import {useMessages} from 'next-intl';

const messages = useMessages();
const authPlaceholders = messages?.auth?.placeholders;
```

`useMessages`는 Provider가 전달한 전체 메시지 객체를 반환합니다. 공통 레이아웃에서 placeholder, SEO 텍스트 등을 재사용해야 할 때 활용합니다.

---

## 4. 숫자 포맷팅

### useFormatter Hook

```typescript
import {useFormatter} from 'next-intl';

export default function Component() {
  const format = useFormatter();

  // 통화 표시
  format.number(499.9, {style: 'currency', currency: 'USD'});
  // 영어: "$499.90"
  // 한국어: "US$499.90"

  // 백분율
  format.number(0.85, {style: 'percent'});
  // "85%"

  // 소수점 자릿수
  format.number(1234.5678, {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
  // 영어: "1,234.57"
  // 한국어: "1,234.57"
}
```

### 글로벌 포맷 사용

**i18n/request.ts에서 포맷 정의:**
```typescript
export default getRequestConfig(async ({locale}) => {
  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default,
    formats: {
      number: {
        price: {
          style: 'currency',
          currency: 'KRW'
        }
      }
    }
  };
});
```

**컴포넌트에서 사용:**
```typescript
format.number(49900, 'price');  // "₩49,900"
```

---

## 5. 날짜/시간 포맷팅

### dateTime() 함수

```typescript
import {useFormatter} from 'next-intl';

export default function Component() {
  const format = useFormatter();
  const date = new Date('2025-10-31T15:30:00');

  // 기본 포맷
  format.dateTime(date, {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
  // 영어: "Oct 31, 2025"
  // 한국어: "2025년 10월 31일"

  // 시간 포함
  format.dateTime(date, {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: 'numeric',
    minute: 'numeric'
  });
  // 한국어: "2025년 10월 31일 오후 3:30"
}
```

### relativeTime() 함수

```typescript
import {useFormatter} from 'next-intl';

export default function Component() {
  const format = useFormatter();
  const now = new Date();
  const twoHoursAgo = new Date(now.getTime() - 2 * 60 * 60 * 1000);

  format.relativeTime(twoHoursAgo, now);
  // 영어: "2 hours ago"
  // 한국어: "2시간 전"

  // 특정 단위 지정
  format.relativeTime(twoHoursAgo, {unit: 'day'});
  // "0 days ago"
}
```

### useNow Hook (자동 업데이트)

```typescript
import {useFormatter, useNow} from 'next-intl';

export default function Component() {
  const format = useFormatter();
  const now = useNow({
    updateInterval: 1000 * 60  // 1분마다 업데이트
  });

  const postDate = new Date('2025-10-31T14:00:00');

  return <span>{format.relativeTime(postDate, now)}</span>;
  // 자동으로 "1시간 전" → "2시간 전"으로 업데이트됨
}
```

---

## 6. 리스트 포맷팅

### list() 함수

```typescript
import {useFormatter} from 'next-intl';

export default function Component() {
  const format = useFormatter();
  const items = ['HTML', 'CSS', 'JavaScript'];

  // 연결형 (and)
  format.list(items, {type: 'conjunction'});
  // 영어: "HTML, CSS, and JavaScript"
  // 한국어: "HTML, CSS 및 JavaScript"

  // 선택형 (or)
  format.list(items, {type: 'disjunction'});
  // 영어: "HTML, CSS, or JavaScript"
  // 한국어: "HTML, CSS 또는 JavaScript"
}
```

### React 요소와 함께 사용

```typescript
const users = [
  <Link href="/users/1">홍길동</Link>,
  <Link href="/users/2">김철수</Link>,
  <Link href="/users/3">이영희</Link>
];

format.list(users);
// "홍길동, 김철수 및 이영희" (각각 링크로 렌더링)
```

---

## 7. 라우팅 설정

### i18n/routing.ts

```typescript
import {defineRouting} from 'next-intl/routing';

export const routing = defineRouting({
  locales: ['en', 'ko', 'ja', 'zh'],
  defaultLocale: 'ko',
  localePrefix: 'as-needed'  // 기본 locale은 접두사 제거
});
```

### navigation.ts

```typescript
import {createNavigation} from 'next-intl/navigation';
import {routing} from './i18n/routing';

export const {Link, redirect, usePathname, useRouter} =
  createNavigation(routing);
```

### Link 컴포넌트 사용

```typescript
import {Link} from '@/navigation';

export default function Component() {
  return (
    <>
      {/* 현재 locale 유지 */}
      <Link href="/forum/list">포럼</Link>

      {/* locale 변경 */}
      <Link href="/forum/list" locale="en">Forum</Link>
    </>
  );
}
```

### useRouter Hook

```typescript
import {useRouter} from '@/navigation';

export default function Component() {
  const router = useRouter();

  const handleClick = () => {
    router.push('/forum/list');  // locale 자동 포함
  };

  return <button onClick={handleClick}>이동</button>;
}
```

### Locale Prefix 전략

**1. `localePrefix: 'always'` (기본값)**
- 모든 경로에 locale 접두사 포함
- 예: `/ko/forum/list`, `/en/forum/list`

**2. `localePrefix: 'as-needed'` (권장)**
- 기본 locale은 접두사 없음
- 다른 locale은 접두사 포함
- 예: `/forum/list` (한국어), `/en/forum/list` (영어)

**3. `localePrefix: 'never'`**
- URL에 locale 표시 안 함
- domain 기반 또는 cookie 기반 locale 결정 시 사용

### Locale Detection

미들웨어가 자동으로 locale을 감지합니다:
1. URL의 locale 접두사
2. `accept-language` 헤더
3. 쿠키 (`NEXT_LOCALE`)

```typescript
// middleware.ts
import createMiddleware from 'next-intl/middleware';
import {routing} from './i18n/routing';

export default createMiddleware(routing);

export const config = {
  matcher: ['/((?!api|_next|.*\\..*).*)']
};
```

### Pathnames 매핑

`routing` 객체의 `pathnames` 옵션을 사용하면 각 locale별로 안정적인 경로를 유지하거나 언어마다 다른 URL을 제공할 수 있습니다. 공식 문서는 SEO 친화적인 다국어 URL을 위해 미리 선언하는 것을 권장합니다.

```ts
// src/i18n/routing.ts
export const routing = defineRouting({
  locales: ['en', 'ko', 'ja', 'zh'],
  defaultLocale: 'ko',
  localePrefix: 'as-needed',
  pathnames: {
    '/forum/list': {
      ko: '/forum/list',
      en: '/forum/list',
      ja: '/forum/list',
      zh: '/forum/list',
    },
    '/auth/login': {
      ko: '/auth/login',
      en: '/auth/login',
      ja: '/auth/login',
      zh: '/auth/login',
    },
  },
});
```

향후 `/menu` → `/メニュー` 같은 언어별 맞춤 경로가 필요할 때는 해당 경로만 별도로 변경하면 됩니다.

### localeDetection & 리다이렉트 제어

```ts
export const routing = defineRouting({
  // ...
  localeDetection: true,
  redirects: {
    '/': 'home', // pathnames.home를 기준으로 리다이렉트
  },
});
```

- `localeDetection`을 `false`로 설정하면 자동 감지를 비활성화하고, `/ko`, `/en` 등 명시적 prefix만 허용합니다.
- `redirects` 옵션을 사용하면 루트 경로를 특정 locale 페이지로 강제 이동시킬 수 있습니다.
- 멀티 도메인이 필요하다면 `domains` 배열에 `{domain, defaultLocale, locales}`를 선언합니다.

---

## 8. 본 프로젝트 적용 가이드

### 8.1 현재 프로젝트 구조
본 프로젝트(Vibe)는 다음과 같은 구조를 가지고 있습니다:
```
app/
  ├── forum/list/page.tsx
  ├── chat/room/page.tsx
  ├── auth/login/page.tsx
  └── layout.tsx
```

### 8.2 다국어 적용 단계별 가이드

#### 1단계: 디렉토리 구조 변경

**변경 전:**
```
app/
  └── forum/list/page.tsx
```

**변경 후:**
```
app/
  ├── [locale]/
  │   └── forum/list/page.tsx
  └── navigation.ts
```

#### 2단계: 번역 파일 생성

**messages/ko.json:**
```json
{
  "common": {
    "submit": "전송",
    "cancel": "취소",
    "loading": "로딩 중..."
  },
  "forum": {
    "title": "포럼",
    "createPost": "글쓰기",
    "category": "카테고리",
    "categories": {
      "community": "커뮤니티",
      "qna": "질문과답변",
      "news": "뉴스",
      "market": "회원장터"
    },
    "noPost": "게시글이 없습니다",
    "firstPost": "첫 번째 게시글을 작성해보세요!"
  },
  "auth": {
    "login": "로그인",
    "signup": "회원가입",
    "email": "이메일",
    "password": "비밀번호"
  }
}
```

**messages/en.json:**
```json
{
  "common": {
    "submit": "Submit",
    "cancel": "Cancel",
    "loading": "Loading..."
  },
  "forum": {
    "title": "Forum",
    "createPost": "Write",
    "category": "Category",
    "categories": {
      "community": "Community",
      "qna": "Q&A",
      "news": "News",
      "market": "Marketplace"
    },
    "noPost": "No posts yet",
    "firstPost": "Write the first post!"
  },
  "auth": {
    "login": "Log in",
    "signup": "Sign up",
    "email": "Email",
    "password": "Password"
  }
}
```

#### 3단계: 컴포넌트에서 번역 사용

**변경 전 (app/forum/list/page.tsx):**
```typescript
<h1 className="text-3xl font-bold">포럼</h1>
<Button onClick={handleCreatePost}>
  <MessageSquarePlus className="h-4 w-4" />
  글쓰기
</Button>
```

**변경 후 (app/[locale]/forum/list/page.tsx):**
```typescript
import {useTranslations} from 'next-intl';

export default function ForumListPage() {
  const t = useTranslations('forum');

  return (
    <>
      <h1 className="text-3xl font-bold">{t('title')}</h1>
      <Button onClick={handleCreatePost}>
        <MessageSquarePlus className="h-4 w-4" />
        {t('createPost')}
      </Button>
    </>
  );
}
```

#### 4단계: 카테고리 목록 다국어화

**app.config.ts 수정:**
```typescript
// 변경 전
export const FORUM_CATEGORIES = [
  { value: "community", label: "커뮤니티" },
  { value: "qna", label: "질문과답변" },
  // ...
];

// 변경 후
export const FORUM_CATEGORIES = [
  { value: "community" },
  { value: "qna" },
  { value: "news" },
  { value: "market" },
] as const;
```

**컴포넌트에서 사용:**
```typescript
const t = useTranslations('forum.categories');

{FORUM_CATEGORIES.map((category) => (
  <SelectItem key={category.value} value={category.value}>
    {t(category.value)}
  </SelectItem>
))}
```

#### 5단계: 날짜/시간 다국어화

**게시글 작성 시간 표시:**
```typescript
const format = useFormatter();
const now = useNow({updateInterval: 60000});  // 1분마다 업데이트

{posts.map((post) => (
  <div key={post.postId}>
    <h3>{post.title}</h3>
    <span>{format.relativeTime(new Date(post.createdAt), now)}</span>
  </div>
))}
```

#### 6단계: 언어 전환 UI 추가

**components/language-switcher.tsx:**
```typescript
'use client';

import {useLocale} from 'next-intl';
import {useRouter, usePathname} from '@/navigation';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";

const languages = [
  {code: 'ko', name: '한국어'},
  {code: 'en', name: 'English'},
  {code: 'ja', name: '日本語'},
  {code: 'zh', name: '中文'}
];

export function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  const handleChange = (newLocale: string) => {
    router.replace(pathname, {locale: newLocale});
  };

  return (
    <Select value={locale} onValueChange={handleChange}>
      <SelectTrigger>
        <SelectValue />
      </SelectTrigger>
      <SelectContent>
        {languages.map((lang) => (
          <SelectItem key={lang.code} value={lang.code}>
            {lang.name}
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}
```

#### 7단계: 라우팅 및 미들웨어 연결

1. `src/i18n/routing.ts`에 `defineRouting`을 정의하고 `locales`, `defaultLocale`, `localePrefix`, `pathnames`를 선언합니다.
2. `app/navigation.ts`에서 `createNavigation(routing)`으로 `Link`, `useRouter`, `usePathname`를 재정의해 locale-aware 네비게이션을 사용합니다.
3. 루트에 `middleware.ts`를 생성하여 `createMiddleware(routing)`을 반환합니다. `matcher`는 `/((?!api|_next|.*\\..*).*)`로 설정해 정적 자산과 API를 제외합니다.

> 공식 문서의 Routing · Setup 예제를 그대로 적용하면 됩니다. 미들웨어는 Vercel Edge에서 실행되므로 가벼운 로직만 유지합니다.

#### 8단계: 포맷 및 기본값 중앙 관리

- `i18n/request.ts`의 `getRequestConfig`에서 `formats.number`, `formats.dateTime`, `formats.list` 등을 정의해 재사용 가능한 프리셋을 만듭니다.
- `defaultTranslationValues`를 사용하면 `{name}` 같은 placeholder의 기본값을 지정할 수 있어 누락 시에도 앱이 깨지지 않습니다.
- `timeZone`, `now` 옵션을 통해 날짜/시간 관련 계산을 일관되게 유지합니다.

### 8.3 우선순위별 적용 순서

**Phase 1: 기본 UI 텍스트 (필수)**
- 공통 버튼 (전송, 취소, 저장 등)
- 네비게이션 메뉴
- 에러 메시지

**Phase 2: 주요 기능 (권장)**
- 게시판 카테고리
- 로그인/회원가입 폼
- 프로필 페이지

**Phase 3: 포맷팅 (선택)**
- 날짜/시간 상대 표시
- 숫자 통화 표시
- 리스트 포맷팅

### 8.4 주의사항

1. **하드코딩된 텍스트 금지**
   - ❌ `<button>전송</button>`
   - ✅ `<button>{t('common.submit')}</button>`

2. **변수는 번역 파일에서 처리**
   - ❌ `{count}개의 게시글`
   - ✅ `{t('forum.postCount', {count})}`

3. **복수형 처리 활용**
   - ❌ `{count === 1 ? '게시글' : '게시글들'}`
   - ✅ `{t('forum.posts', {count})}`

4. **날짜는 항상 포맷팅**
   - ❌ `new Date(post.createdAt).toLocaleDateString()`
   - ✅ `format.dateTime(new Date(post.createdAt), {...})`

### 8.5 성능 최적화

1. **Server Components에서 번역 로드**
   ```typescript
   import {getTranslations} from 'next-intl/server';

   export default async function Page() {
     const t = await getTranslations('forum');
     // ...
   }
   ```

2. **클라이언트에서는 필요한 네임스페이스만**
   ```typescript
   const t = useTranslations('forum');  // 전체 메시지가 아닌 forum만
   ```

3. **공통 번역은 레이아웃에서 제공**
   ```typescript
   // app/[locale]/layout.tsx
   const messages = await getMessages();
   return (
     <NextIntlClientProvider messages={pick(messages, ['common'])}>
       {children}
     </NextIntlClientProvider>
   );
   ```

### 8.6 핵심 컴포넌트 적용 예시

- **Topbar (`components/topbar.tsx`)**
  - `useTranslations('navigation')`으로 포럼/채팅/사용자 메뉴 라벨을 치환합니다.
  - 로그인 상태별 버튼 텍스트(`로그인`, `회원가입`, `프로필 수정`)를 `auth`, `profile` 네임스페이스로 분리합니다.
  - 드롭다운 또는 모바일 메뉴에 `LanguageSwitcher`를 배치해 locale 전환을 제공합니다.

  ```tsx
  const tNav = useTranslations('navigation');

  <Button variant="ghost" size="sm" asChild>
    <Link href="/forum/list">
      <LayoutGrid className="h-4 w-4 mr-2" />
      {tNav('forum')}
    </Link>
  </Button>
  ```

- **메뉴 페이지 (`app/menu/page.tsx`)**
  - `useTranslations('menu')`로 버튼 레이블과 설명 문구를 구성합니다.
  - 회원 정보 카드에서 `format.list`를 사용해 사용자 역할 등을 자연어로 병기할 수 있습니다.
  - 로그아웃 버튼 알림 문구는 `t('menu.logout.confirm')` 같이 별도 키로 관리합니다.

- **포럼 & 채팅 페이지 (`app/[locale]/forum/**`, `app/[locale]/chat/**`)**
  - 서버 컴포넌트에서 `getTranslations('forum')` 또는 `getTranslations('chat')`로 SEO 텍스트와 타이틀을 설정합니다.
  - 게시글/메시지 타임스탬프에 `format.relativeTime`을 적용하고, 숫자 통계(조회수·좋아요)는 `format.number`를 사용합니다.

- **공유 구성 (`app/app.config.ts`, `app/config/forum.ts` 등)**
  - `FORUM_CATEGORIES`처럼 label을 가진 상수는 `value`만 유지하고, 표시 문자열은 `t('forum.categories.community')`로 불러옵니다.
  - Validation/에러 메시지는 `messages/common/errors.json`과 같이 별도 파일에 묶어 재사용합니다.

### 8.7 테스트 및 QA 체크리스트

- `/`, `/forum/list`, `/auth/login`, `/menu`, `/admin`을 각 locale로 전환하며 경로와 텍스트가 올바르게 렌더링되는지 확인합니다.
- Locale 전환 시 쿼리스트링과 해시값이 유지되는지, `router.replace`가 예상대로 동작하는지 검증합니다.
- 숫자·날짜 포맷이 locale별 기대값(예: `₩49,900`, `2025년 10월 31일`, `2시간 전`)과 일치하는지 샘플 데이터를 기준으로 확인합니다.
- 미들웨어가 인증 여부와 무관하게 동일한 locale 정책을 적용하는지, 보호 페이지(`profile`, `chat/room`, `admin/*`)가 올바르게 리다이렉트되는지 확인합니다.
- 메시지 누락 시 fallback(`defaultTranslationValues`, 영어 기본 메시지)이 노출되는지 확인하고, 브라우저 콘솔에 경고가 없는지 점검합니다.

---

## 참고 자료

- [Next-Intl 공식 문서](https://next-intl.dev/)
- [Next-Intl GitHub](https://github.com/amannn/next-intl)
- [MDN Intl API](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl)
- [Unicode CLDR](http://cldr.unicode.org/) - 언어별 복수형 규칙
