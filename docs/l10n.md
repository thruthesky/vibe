다국어 적용 지침:
- 본 문서는 영어, 한국어, 일본어, 중국어 등의 다국어를 지원하기 위한 지침을 제공합니다.
- 다국어 적용을 할 때에는 반드시 본 지침을 준수해야 합니다.

# 다국어 적용 개요

1. 다국어 지원을 위해 Next-Intl 4.0 라이브러리를 사용합니다.
2. 지원 언어: 영어(en), 한국어(ko), 일본어(ja), 중국어(zh)
3. 공식 문서 참고:
   - https://next-intl.dev/docs/getting-started/app-router
   - https://next-intl.dev/docs/usage/translations
   - https://next-intl.dev/docs/routing/setup
   - https://github.com/amannn/next-intl

---

## 목차
1. [설치 및 초기 설정](#1-설치-및-초기-설정)
2. [디렉토리 구조](#2-디렉토리-구조)
3. [번역 사용법](#3-번역-사용법)
4. [숫자 포맷팅](#4-숫자-포맷팅)
5. [날짜/시간 포맷팅](#5-날짜시간-포맷팅)
6. [리스트 포맷팅](#6-리스트-포맷팅)
7. [라우팅 설정](#7-라우팅-설정)
8. [본 프로젝트 적용 가이드](#8-본-프로젝트-적용-가이드)

---

## 1. 설치 및 초기 설정

### 패키지 설치
```bash
npm install next-intl
```

⚠️ **참고**: 본 프로젝트에는 Next-Intl 4.0이 이미 설치되어 있습니다.

### next.config.ts 설정
```typescript
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin();

export default withNextIntl({
  // 기존 Next.js 설정
});
```

---

## 2. 디렉토리 구조

```
├── messages/               # 번역 파일 디렉토리
│   ├── en.json            # 영어 번역
│   ├── ko.json            # 한국어 번역
│   ├── ja.json            # 일본어 번역
│   └── zh.json            # 중국어 번역
├── src/
│   ├── i18n/
│   │   ├── request.ts     # 요청별 설정 객체 생성
│   │   └── routing.ts     # 라우팅 설정 (지원 언어, 기본 locale)
│   ├── middleware.ts       # locale 감지 및 라우팅
│   └── app/
│       ├── [locale]/      # locale 동적 세그먼트
│       │   ├── layout.tsx # 루트 레이아웃
│       │   └── page.tsx   # 페이지
│       └── navigation.ts  # 라우팅 유틸리티
└── next.config.ts
```

### i18n/request.ts
요청별 설정 객체를 생성하여 locale과 메시지를 제공합니다.

```typescript
import {getRequestConfig} from 'next-intl/server';

export default getRequestConfig(async ({locale}) => {
  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default
  };
});
```

### messages/ko.json 예시
```json
{
  "common": {
    "submit": "전송",
    "cancel": "취소",
    "save": "저장",
    "delete": "삭제"
  },
  "auth": {
    "login": "로그인",
    "signup": "회원가입",
    "logout": "로그아웃"
  },
  "forum": {
    "title": "포럼",
    "createPost": "글쓰기",
    "noPost": "게시글이 없습니다"
  }
}
```

---

## 3. 번역 사용법

### useTranslations Hook

**기본 사용법:**
```typescript
import {useTranslations} from 'next-intl';

export default function Component() {
  const t = useTranslations('common');

  return (
    <button>{t('submit')}</button>
  );
}
```

### 중첩된 메시지 구조

**JSON 파일:**
```json
{
  "auth": {
    "SignUp": {
      "form": {
        "placeholder": "이메일을 입력하세요"
      }
    }
  }
}
```

**컴포넌트:**
```typescript
const t = useTranslations('auth.SignUp');
return <input placeholder={t('form.placeholder')} />;
```

### 변수 삽입 (Interpolation)

**JSON 파일:**
```json
{
  "welcome": "안녕하세요, {name}님!",
  "itemCount": "{count}개의 항목"
}
```

**컴포넌트:**
```typescript
const t = useTranslations('common');

t('welcome', {name: '홍길동'});  // "안녕하세요, 홍길동님!"
t('itemCount', {count: 5});       // "5개의 항목"
```

### 복수형 처리

**기수 복수형 (plural):**
```json
{
  "followers": "팔로워 {count, plural, =0 {없음} =1 {# 명} other {# 명}}"
}
```

```typescript
t('followers', {count: 0});  // "팔로워 없음"
t('followers', {count: 1});  // "팔로워 1 명"
t('followers', {count: 5});  // "팔로워 5 명"
```

**서수 복수형 (selectordinal):**
```json
{
  "birthday": "{year, selectordinal, one {#번째} other {#번째}} 생일"
}
```

---

## 4. 숫자 포맷팅

### useFormatter Hook

```typescript
import {useFormatter} from 'next-intl';

export default function Component() {
  const format = useFormatter();

  // 통화 표시
  format.number(499.9, {style: 'currency', currency: 'USD'});
  // 영어: "$499.90"
  // 한국어: "US$499.90"

  // 백분율
  format.number(0.85, {style: 'percent'});
  // "85%"

  // 소수점 자릿수
  format.number(1234.5678, {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
  // 영어: "1,234.57"
  // 한국어: "1,234.57"
}
```

### 글로벌 포맷 사용

**i18n/request.ts에서 포맷 정의:**
```typescript
export default getRequestConfig(async ({locale}) => {
  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default,
    formats: {
      number: {
        price: {
          style: 'currency',
          currency: 'KRW'
        }
      }
    }
  };
});
```

**컴포넌트에서 사용:**
```typescript
format.number(49900, 'price');  // "₩49,900"
```

---

## 5. 날짜/시간 포맷팅

### dateTime() 함수

```typescript
import {useFormatter} from 'next-intl';

export default function Component() {
  const format = useFormatter();
  const date = new Date('2025-10-31T15:30:00');

  // 기본 포맷
  format.dateTime(date, {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
  // 영어: "Oct 31, 2025"
  // 한국어: "2025년 10월 31일"

  // 시간 포함
  format.dateTime(date, {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: 'numeric',
    minute: 'numeric'
  });
  // 한국어: "2025년 10월 31일 오후 3:30"
}
```

### relativeTime() 함수

```typescript
import {useFormatter} from 'next-intl';

export default function Component() {
  const format = useFormatter();
  const now = new Date();
  const twoHoursAgo = new Date(now.getTime() - 2 * 60 * 60 * 1000);

  format.relativeTime(twoHoursAgo, now);
  // 영어: "2 hours ago"
  // 한국어: "2시간 전"

  // 특정 단위 지정
  format.relativeTime(twoHoursAgo, {unit: 'day'});
  // "0 days ago"
}
```

### useNow Hook (자동 업데이트)

```typescript
import {useFormatter, useNow} from 'next-intl';

export default function Component() {
  const format = useFormatter();
  const now = useNow({
    updateInterval: 1000 * 60  // 1분마다 업데이트
  });

  const postDate = new Date('2025-10-31T14:00:00');

  return <span>{format.relativeTime(postDate, now)}</span>;
  // 자동으로 "1시간 전" → "2시간 전"으로 업데이트됨
}
```

---

## 6. 리스트 포맷팅

### list() 함수

```typescript
import {useFormatter} from 'next-intl';

export default function Component() {
  const format = useFormatter();
  const items = ['HTML', 'CSS', 'JavaScript'];

  // 연결형 (and)
  format.list(items, {type: 'conjunction'});
  // 영어: "HTML, CSS, and JavaScript"
  // 한국어: "HTML, CSS 및 JavaScript"

  // 선택형 (or)
  format.list(items, {type: 'disjunction'});
  // 영어: "HTML, CSS, or JavaScript"
  // 한국어: "HTML, CSS 또는 JavaScript"
}
```

### React 요소와 함께 사용

```typescript
const users = [
  <Link href="/users/1">홍길동</Link>,
  <Link href="/users/2">김철수</Link>,
  <Link href="/users/3">이영희</Link>
];

format.list(users);
// "홍길동, 김철수 및 이영희" (각각 링크로 렌더링)
```

---

## 7. 라우팅 설정

### i18n/routing.ts

```typescript
import {defineRouting} from 'next-intl/routing';

export const routing = defineRouting({
  locales: ['en', 'ko', 'ja', 'zh'],
  defaultLocale: 'ko',
  localePrefix: 'as-needed'  // 기본 locale은 접두사 제거
});
```

### navigation.ts

```typescript
import {createNavigation} from 'next-intl/navigation';
import {routing} from './i18n/routing';

export const {Link, redirect, usePathname, useRouter} =
  createNavigation(routing);
```

### Link 컴포넌트 사용

```typescript
import {Link} from '@/navigation';

export default function Component() {
  return (
    <>
      {/* 현재 locale 유지 */}
      <Link href="/forum/list">포럼</Link>

      {/* locale 변경 */}
      <Link href="/forum/list" locale="en">Forum</Link>
    </>
  );
}
```

### useRouter Hook

```typescript
import {useRouter} from '@/navigation';

export default function Component() {
  const router = useRouter();

  const handleClick = () => {
    router.push('/forum/list');  // locale 자동 포함
  };

  return <button onClick={handleClick}>이동</button>;
}
```

### Locale Prefix 전략

**1. `localePrefix: 'always'` (기본값)**
- 모든 경로에 locale 접두사 포함
- 예: `/ko/forum/list`, `/en/forum/list`

**2. `localePrefix: 'as-needed'` (권장)**
- 기본 locale은 접두사 없음
- 다른 locale은 접두사 포함
- 예: `/forum/list` (한국어), `/en/forum/list` (영어)

**3. `localePrefix: 'never'`**
- URL에 locale 표시 안 함
- domain 기반 또는 cookie 기반 locale 결정 시 사용

### Locale Detection

미들웨어가 자동으로 locale을 감지합니다:
1. URL의 locale 접두사
2. `accept-language` 헤더
3. 쿠키 (`NEXT_LOCALE`)

```typescript
// middleware.ts
import createMiddleware from 'next-intl/middleware';
import {routing} from './i18n/routing';

export default createMiddleware(routing);

export const config = {
  matcher: ['/((?!api|_next|.*\\..*).*)']
};
```

---

## 8. 본 프로젝트 적용 가이드

### 8.1 현재 프로젝트 구조
본 프로젝트(Vibe)는 다음과 같은 구조를 가지고 있습니다:
```
app/
  ├── forum/list/page.tsx
  ├── chat/room/page.tsx
  ├── auth/login/page.tsx
  └── layout.tsx
```

### 8.2 다국어 적용 단계별 가이드

#### 1단계: 디렉토리 구조 변경

**변경 전:**
```
app/
  └── forum/list/page.tsx
```

**변경 후:**
```
app/
  ├── [locale]/
  │   └── forum/list/page.tsx
  └── navigation.ts
```

#### 2단계: 번역 파일 생성

**messages/ko.json:**
```json
{
  "common": {
    "submit": "전송",
    "cancel": "취소",
    "loading": "로딩 중..."
  },
  "forum": {
    "title": "포럼",
    "createPost": "글쓰기",
    "category": "카테고리",
    "categories": {
      "community": "커뮤니티",
      "qna": "질문과답변",
      "news": "뉴스",
      "market": "회원장터"
    },
    "noPost": "게시글이 없습니다",
    "firstPost": "첫 번째 게시글을 작성해보세요!"
  },
  "auth": {
    "login": "로그인",
    "signup": "회원가입",
    "email": "이메일",
    "password": "비밀번호"
  }
}
```

**messages/en.json:**
```json
{
  "common": {
    "submit": "Submit",
    "cancel": "Cancel",
    "loading": "Loading..."
  },
  "forum": {
    "title": "Forum",
    "createPost": "Write",
    "category": "Category",
    "categories": {
      "community": "Community",
      "qna": "Q&A",
      "news": "News",
      "market": "Marketplace"
    },
    "noPost": "No posts yet",
    "firstPost": "Write the first post!"
  },
  "auth": {
    "login": "Log in",
    "signup": "Sign up",
    "email": "Email",
    "password": "Password"
  }
}
```

#### 3단계: 컴포넌트에서 번역 사용

**변경 전 (app/forum/list/page.tsx):**
```typescript
<h1 className="text-3xl font-bold">포럼</h1>
<Button onClick={handleCreatePost}>
  <MessageSquarePlus className="h-4 w-4" />
  글쓰기
</Button>
```

**변경 후 (app/[locale]/forum/list/page.tsx):**
```typescript
import {useTranslations} from 'next-intl';

export default function ForumListPage() {
  const t = useTranslations('forum');

  return (
    <>
      <h1 className="text-3xl font-bold">{t('title')}</h1>
      <Button onClick={handleCreatePost}>
        <MessageSquarePlus className="h-4 w-4" />
        {t('createPost')}
      </Button>
    </>
  );
}
```

#### 4단계: 카테고리 목록 다국어화

**app.config.ts 수정:**
```typescript
// 변경 전
export const FORUM_CATEGORIES = [
  { value: "community", label: "커뮤니티" },
  { value: "qna", label: "질문과답변" },
  // ...
];

// 변경 후
export const FORUM_CATEGORIES = [
  { value: "community" },
  { value: "qna" },
  { value: "news" },
  { value: "market" },
] as const;
```

**컴포넌트에서 사용:**
```typescript
const t = useTranslations('forum.categories');

{FORUM_CATEGORIES.map((category) => (
  <SelectItem key={category.value} value={category.value}>
    {t(category.value)}
  </SelectItem>
))}
```

#### 5단계: 날짜/시간 다국어화

**게시글 작성 시간 표시:**
```typescript
const format = useFormatter();
const now = useNow({updateInterval: 60000});  // 1분마다 업데이트

{posts.map((post) => (
  <div key={post.postId}>
    <h3>{post.title}</h3>
    <span>{format.relativeTime(new Date(post.createdAt), now)}</span>
  </div>
))}
```

#### 6단계: 언어 전환 UI 추가

**components/language-switcher.tsx:**
```typescript
'use client';

import {useLocale} from 'next-intl';
import {useRouter, usePathname} from '@/navigation';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";

const languages = [
  {code: 'ko', name: '한국어'},
  {code: 'en', name: 'English'},
  {code: 'ja', name: '日本語'},
  {code: 'zh', name: '中文'}
];

export function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  const handleChange = (newLocale: string) => {
    router.replace(pathname, {locale: newLocale});
  };

  return (
    <Select value={locale} onValueChange={handleChange}>
      <SelectTrigger>
        <SelectValue />
      </SelectTrigger>
      <SelectContent>
        {languages.map((lang) => (
          <SelectItem key={lang.code} value={lang.code}>
            {lang.name}
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}
```

### 8.3 우선순위별 적용 순서

**Phase 1: 기본 UI 텍스트 (필수)**
- 공통 버튼 (전송, 취소, 저장 등)
- 네비게이션 메뉴
- 에러 메시지

**Phase 2: 주요 기능 (권장)**
- 게시판 카테고리
- 로그인/회원가입 폼
- 프로필 페이지

**Phase 3: 포맷팅 (선택)**
- 날짜/시간 상대 표시
- 숫자 통화 표시
- 리스트 포맷팅

### 8.4 주의사항

1. **하드코딩된 텍스트 금지**
   - ❌ `<button>전송</button>`
   - ✅ `<button>{t('common.submit')}</button>`

2. **변수는 번역 파일에서 처리**
   - ❌ `{count}개의 게시글`
   - ✅ `{t('forum.postCount', {count})}`

3. **복수형 처리 활용**
   - ❌ `{count === 1 ? '게시글' : '게시글들'}`
   - ✅ `{t('forum.posts', {count})}`

4. **날짜는 항상 포맷팅**
   - ❌ `new Date(post.createdAt).toLocaleDateString()`
   - ✅ `format.dateTime(new Date(post.createdAt), {...})`

### 8.5 성능 최적화

1. **Server Components에서 번역 로드**
   ```typescript
   import {getTranslations} from 'next-intl/server';

   export default async function Page() {
     const t = await getTranslations('forum');
     // ...
   }
   ```

2. **클라이언트에서는 필요한 네임스페이스만**
   ```typescript
   const t = useTranslations('forum');  // 전체 메시지가 아닌 forum만
   ```

3. **공통 번역은 레이아웃에서 제공**
   ```typescript
   // app/[locale]/layout.tsx
   const messages = await getMessages();
   return (
     <NextIntlClientProvider messages={pick(messages, ['common'])}>
       {children}
     </NextIntlClientProvider>
   );
   ```

---

## 참고 자료

- [Next-Intl 공식 문서](https://next-intl.dev/)
- [Next-Intl GitHub](https://github.com/amannn/next-intl)
- [MDN Intl API](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl)
- [Unicode CLDR](http://cldr.unicode.org/) - 언어별 복수형 규칙